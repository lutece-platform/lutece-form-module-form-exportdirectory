<p class="lead">#i18n{module.form.exportdirectory.configuration_exportdirectory.title}</p>
<#if permission_manage>
	<#if is_mapped>
		<p>
			#i18n{module.form.exportdirectory.configuration_exportdirectory.is_mapped.title} : <strong>${mapped_directory_title}</strong>
		</p>
	</#if>
	<@formGroup rows=2>
		<@btnGroup params='data-toggle="buttons"'>
			<#if is_mapped>
				<@btnGroupRadioCheckbox type='radio' name='action_exportdirectory' id='delete_mapping_directory'  value='delete_mapping_directory' labelParams='onclick="javascript:exportDirectory(this)"' labelFor='delete_mapping_directory' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.removeMappingDirectory}' />
			</#if>
			
			<#if is_mapped>
				<#assign labelKey = '#i18n{module.form.exportdirectory.configuration_exportdirectory.isMapped.createDirectory}' />
			<#else>
				<#assign labelKey = '#i18n{module.form.exportdirectory.configuration_exportdirectory.createDirectory}' />
			</#if>
			<@btnGroupRadioCheckbox type='radio' name='action_exportdirectory' id='create_directory' value='create_directory' labelParams='onclick="javascript:exportDirectory(this)"' labelFor='create_directory' labelKey=labelKey />
			
			<#if !directory_list_is_empty>
				<#if is_mapped>
					<#assign labelKey = '#i18n{module.form.exportdirectory.configuration_exportdirectory.isMapped.useDirectory}' />
				<#else>
					<#assign labelKey = '#i18n{module.form.exportdirectory.configuration_exportdirectory.useDirectory}' />
				</#if>
				<#if use_directory_exist>
					<@btnGroupRadioCheckbox type='radio' name='action_exportdirectory' id='use_directory_exist' value='use_directory_exist' labelFor='use_directory_exist' labelKey=labelKey checked=true labelParams='onclick="javascript:exportDirectory(this)"' />
				<#else>
					<@btnGroupRadioCheckbox type='radio' name='action_exportdirectory' id='use_directory_exist' value='use_directory_exist' labelFor='use_directory_exist' labelKey=labelKey labelParams='onclick="javascript:exportDirectory(this)"' />
				</#if>
			</#if>
		</@btnGroup>
	</@formGroup>

	
	<#if !directory_list_is_empty>
	<div id="display_use_directory_exist" style="display:none;">
		<@formGroup rows=2 labelFor='directory_list' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.directoryExist}'>
			<@inputGroup>
				<@select name='id_directory' items=directory_list default_value=directory_list_default_item?string size='sm' />
				<@inputGroupItem>
					<@button type='submit' name='redirect' buttonIcon='check' color='btn-secondary' />
				</@inputGroupItem>
			</@inputGroup>
		</@formGroup>
		<fieldset>
			<legend>#i18n{module.form.exportdirectory.configuration_exportdirectory.useDirectory.title}</legend>
			<#list entry_configuration_list as entry>
				<@formGroup rows=2 labelKey='${entry.use_directory_form_entry.formEntryTitle}' mandatory=true>
					<@select name='id_entry_directory_for_form_entry_${entry.use_directory_form_entry.idFormEntry}' items=entry.use_directory_list_directory_entry default_value=entry.use_directory_default_directory_entry?string />
				</@formGroup>
			</#list>
		</fieldset>
	</div>
	</#if>
	
	<div id="display_create_directory" style="display:none;">
		<#if workflow_list?exists && workflow_list?size &gt; 0 >
			<@formGroup rows=2 labelFor='id_workflow' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.labelAddWorkflow}'>
				<@select name='id_workflow' items=workflow_list default_value='-1' />
			</@formGroup>
		</#if>
		<#if entry_configuration_list?exists && entry_configuration_list?size &gt; 0 >
		<@table>
			<tr>
				<th>#i18n{module.form.exportdirectory.configuration_exportdirectory.entry_form}</th>
					<th>#i18n{module.form.exportdirectory.configuration_exportdirectory.result_list}</th>
					<th>#i18n{module.form.exportdirectory.configuration_exportdirectory.search}</th>
				</tr>
			<#list entry_configuration_list as entry>
			<tr>
				<td>${entry.use_directory_form_entry.formEntryTitle}</td>
				<td><input type="checkbox" name="is_in_result_list_${entry.use_directory_form_entry.idFormEntry}" /></td>
				<#if entry.use_directory_form_entry_type!=entry_type_file & entry.use_directory_form_entry_type!=entry_type_image>
				<td><input type="checkbox" name="is_in_search_${entry.use_directory_form_entry.idFormEntry}" /></td>
					<#else>
				<td>&nbsp;</td>
				</#if>
			</tr>
			</#list>
		</@table>
		</#if>
		
		<@formGroup labelFor='add_numbering_entry1' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.labelAddNumberingEntry}' rows=2>
			<@radioButton orientation='horizontal' labelFor='add_numbering_entry' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.labelAddNumberingEntryYes}' name='add_numbering_entry' id='add_numbering_entry1' value='1' checked=true />
			<@radioButton orientation='horizontal' labelFor='add_numbering_entry' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.labelAddNumberingEntryNo}' name='add_numbering_entry' id='add_numbering_entry2' value='0' />
		</@formGroup>
		
		<@formGroup labelFor='add_numbering_entry_prefix' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.labelAddNumberingEntryPrefix}' rows=2>
			<@input type='text' name='add_numbering_entry_prefix' value='' maxlength=255 />
		</@formGroup>
		
		<@formGroup labelFor='activate_directory_record' helpKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.useDirectory.activate_directory_record_comment}' rows=2>
			<@checkBox name='activate_directory_record' id='activate_directory_record' value='1' checked=true labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.useDirectory.activate_directory_record}' />
		</@formGroup>
		
		<@formGroup labelFor='is_indexed' helpKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.useDirectory.is_indexed_comment}' rows=2>
			<@checkBox name='is_indexed' id='is_indexed' value='1' checked=true labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.useDirectory.is_indexed}' />
		</@formGroup>
		
		<#if create_directory?has_content>
			<fieldset id="directoryTypeEntry">
				<legend>#i18n{module.form.exportdirectory.configuration_exportdirectory.createDirectory.title}</legend>
				<#list create_directory as entry>
				<@formGroup labelKey='${entry.form_entry.title}' rows=2>
					<#list entry.directory_entry_type as entry_type>
						<@radioButton orientation='horizontal' name='id_entry_type_${entry.form_entry.idEntry}' value='${entry_type.idType}' labelKey='#i18n{${entry_type.titleI18nKey}}' />
					</#list>
				</@formGroup>
				</#list>
			</fieldset>
		</#if>
		
		<#if (list_entry_image?size > 0) >
			<fieldset>
				<legend>#i18n{module.form.exportdirectory.configuration_exportdirectory.image_configuration} :</legend>
				<#list list_entry_image as image>
					<label>${image.title}</label>
					
					<@formGroup labelFor='create_thumbnail_${image.idEntry}' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.generate_thumbnail}' showLabel=false>
						<@checkBox name='create_thumbnail_${image.idEntry}' id='create_thumbnail_${image.idEntry}' params='onclick="hideField(\'create_thumbnail_${image.idEntry}\', \'thumbnail_field_${image.idEntry}\');"' labelFor='create_thumbnail_${image.idEntry}' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.generate_thumbnail}' />
					</@formGroup>
					
					<div name="thumbnail_field_${image.idEntry}" id="thumbnail_field_${image.idEntry}">
						<@formGroup labelFor='thumbnail_height_${image.idEntry}' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.thumbnail_height}*' rows=2>
							<@input type='text' name='thumbnail_height_${image.idEntry}' id='thumbnail_height_${image.idEntry}' />
						</@formGroup>
						<@formGroup labelFor='thumbnail_width_${image.idEntry}' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.thumbnail_width}*' rows=2>
							<@input type='text' name='thumbnail_width_${image.idEntry}' id='thumbnail_width_${image.idEntry}' />
						</@formGroup>
					</div>
					
					<@formGroup labelFor='create_big_thumbnail_${image.idEntry}' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.generate_big_thumbnail}' showLabel=false>
						<@checkBox name='create_big_thumbnail_${image.idEntry}' id='create_big_thumbnail_${image.idEntry}' params='onclick="hideField( \'create_big_thumbnail_${image.idEntry}\',\'big_thumbnail_field_${image.idEntry}\')"' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.generate_big_thumbnail}' />
					</@formGroup>
					
					<div name="big_thumbnail_field_${image.idEntry}" id="big_thumbnail_field_${image.idEntry}">		
						<@formGroup labelFor='' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.thumbnail_height} *' rows=2>
							<@input type='text' name='big_thumbnail_height_${image.idEntry}' id='big_thumbnail_height_${image.idEntry}' />
						</@formGroup>
						<@formGroup labelFor='' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.thumbnail_width} *' rows=2>
							<@input type='text' name='big_thumbnail_width_${image.idEntry}' id='big_thumbnail_width_${image.idEntry}' />
						</@formGroup>
					</div>
				</#list>
			</fieldset>
		</#if>
		
	
		<#list list_entry_geolocalisation as entry>
			<fieldset>
				<legend>${entry.title} <#if entry.mapProvider?has_content>(${entry.mapProvider.displayedName})</#if></legend>
				<#assign labelKey>
					${entry.title}
					<#if entry.mapProvider?has_content> (${entry.mapProvider.displayedName})</#if>
				</#assign>
				<@formGroup labelKey=labelKey rows=2 mandatory=true>
					<#list list_directory_map_providers as map_provider>
						<@radioButton name='key_geolocation_${entry.idEntry}' value='${map_provider.key}' labelKey='${map_provider.displayedName}' />
					</#list>
					<@radioButton name='key_geolocation_${entry.idEntry}' value='none' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.noMapProvider}' />
				</@formGroup>
			</fieldset>
		</#list>
	</div>
		
	<#if record_form &gt; 0>
		<div id="record_Form" style="display:none;">
			<@callOut color='warning'>
				<@icon style='warning' /> #i18n{module.form.exportdirectory.configuration_exportdirectory.labelExportAll}
				<@formGroup labelFor='export_all' rows=2>
					<@radioButton orientation='horizontal' name='export_all' id='export_record_form' value='1' checked=true labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.labelExportAllYes}' />
					<@radioButton orientation='horizontal' name='export_all' id='export_record_form' value='0' labelKey='#i18n{module.form.exportdirectory.configuration_exportdirectory.labelExportAllNo}' />
				</@formGroup>
			</@callOut>
		</div>
	</#if>
<#else>
	<@callOut title='#i18n{module.form.exportdirectory.configuration_exportdirectory.labelNotPermission}' titleLevel='p' callOutIcon='warning' color='danger' />
</#if>

<script type="text/javascript">

<#if (list_entry_image?size > 0) >
<#list list_entry_image as image>
document.getElementById( 'thumbnail_field_${image.idEntry}' ).style.display="none";
document.getElementById( 'big_thumbnail_field_${image.idEntry}' ).style.display="none";
</#list>
</#if>

<#if use_directory_exist?? && use_directory_exist>
	<#if !directory_list_is_empty>
		document.getElementById("display_use_directory_exist").style.display="block";
	</#if>
	<#if record_form &gt; 0>
		document.getElementById("record_Form").style.display="block";
	</#if>
	document.getElementById("use_directory_exist").parentElement.classList.add('active');
</#if>

function exportDirectory(buttonElement) {
	elementId = buttonElement.querySelector(":scope > input").id;
	var currentBtn = document.getElementById(elementId);
	currentBtn.checked=true;
	
	if (elementId == "delete_mapping_directory" || "use_directory_exist") {
		if(currentBtn.checked) {
			var asterisks = $("label.col-xs-12").children();
			$(asterisks).remove();
			
			var radioButtons = $("[name^='id_entry_type_']");
			for (i=0; i < radioButtons.length; i++) {
				radioButton = radioButtons[i];
				$(radioButton).removeAttr("required","true");
			};
		};
	}
	
	if (elementId == "delete_mapping_directory") {
		if(currentBtn.checked)
		{
			document.getElementById("display_use_directory_exist").style.display="none";
			document.getElementById("display_create_directory").style.display="none";
			document.getElementById("record_Form").style.display="none";
		}
	}	else if (elementId == "create_directory") {
		if(currentBtn.checked)
		{
			<#if !directory_list_is_empty>
			document.getElementById("display_use_directory_exist").style.display="none";
			</#if>
			<#if record_form &gt; 0>
			document.getElementById("record_Form").style.display="block";
			</#if>
			document.getElementById("display_create_directory").style.display="block";
			
			var radioButtonsLabels = $("#directoryTypeEntry").find("label.col-xs-12");
			for (i=0; i < radioButtonsLabels.length; i++) {
				var radioButtonLabel = radioButtonsLabels[i];
				var asterisk = '<i class="fa fa-asterisk"></i>';
				$(radioButtonLabel).append(asterisk);
			}
			
			var radioButtons = $("[name^='id_entry_type_']");
			for (i=0; i < radioButtons.length; i++) {
				radioButton = radioButtons[i];
				$(radioButton).attr("required","true");
			}

		}
	}	else if (elementId == "use_directory_exist") {
		if(currentBtn.checked)
		{
			<#if !directory_list_is_empty>
			document.getElementById("display_create_directory").style.display="none";
			<#if !directory_list_is_empty>
				document.getElementById("display_use_directory_exist").style.display="block";
			</#if>
			<#if record_form &gt; 0>
				document.getElementById("record_Form").style.display="block";
			</#if>
			</#if>
		}
	}
}

function hideField( checkbox, field ){
var objcheckbox = document.getElementById(checkbox);
var objfield = document.getElementById(field);		
objfield.style.display=(objcheckbox.checked==false)?"none":"block";
return true;
}
</script>